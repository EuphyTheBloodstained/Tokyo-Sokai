<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大谷翔平 打撃成績予想ツール</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
            text-align: center;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            max-width: 800px; /* 横幅を広げた */
            margin: 30px auto;
        }
        h1 {
            color: #0056b3;
            margin-bottom: 25px;
            font-size: 2em;
        }
        .button-group {
            margin-bottom: 25px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease;
            margin: 0 10px; /* ボタン間のスペース */
        }
        button:hover {
            background-color: #0056b3;
        }
        .result-section {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
            text-align: left; /* 結果表示を左寄せに */
        }
        .at-bat {
            background-color: #e9f7ff;
            border: 1px solid #cce7ff;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            font-size: 1.1em;
        }
        .summary {
            font-size: 1.1em;
            font-weight: bold;
            color: #0066cc;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px dashed #ddd;
        }
        .season-summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .season-summary-table th, .season-summary-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .season-summary-table th {
            background-color: #f2f2f2;
            color: #555;
        }
        ul {
            list-style-type: none;
            padding: 0;
            text-align: left;
            margin-top: 20px;
            font-size: 0.9em;
            color: #666;
        }
        li {
            margin-bottom: 8px;
        }
        .note {
            margin-top: 30px;
            font-size: 0.85em;
            color: #888;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>大谷翔平 打撃成績予想ツール</h1>
        <p>「予想する」ボタンをクリックすると、大谷翔平選手の通算打撃成績に基づき、打撃結果をシミュレーションします。</p>
        <div class="button-group">
            <button onclick="predictGame()">1試合の結果を予想する (4打席)</button>
            <button onclick="predictSeason()">1シーズン (162試合) の結果を予想する</button>
        </div>

        <div class="result-section" id="resultSection">
            </div>

        <div class="note">
            <p>※ このツールは、公開されている大谷翔平選手の過去の打撃成績（打席数、安打数、二塁打数、三塁打数、本塁打数、四球数、三振数など）を基に各結果の確率を算出し、乱数を用いてシミュレーションしています。</p>
            <p>※ 実際の試合結果を保証するものではありません。</p>
            <p>※ 確率の計算に使用しているデータは、このツールの作成時点（2025年7月16日）での一般的な情報に基づいており、リアルタイムの最新データではありません。</p>
            <ul>
                <li>参考データ（例 - 割合は適宜調整してください）：</li>
                <li>打席あたりの結果</li>
                <ul>
                    <li>単打: 18.0%</li>
                    <li>二塁打: 5.0%</li>
                    <li>三塁打: 0.5%</li>
                    <li>本塁打: 6.5%</li>
                    <li>四球: 12.0%</li>
                    <li>三振: 25.0%</li>
                    <li>凡打: 33.0% (内訳は等確率で割り振られます)</li>
                </ul>
            </ul>
        </div>
    </div>

    <script>
        // 大谷翔平選手の通算打撃成績に基づく確率（あくまで例示であり、正確な最新データではありません）
        // 実際にはより詳細なデータ（打数、安打、二塁打、三塁打、本塁打、四球、三振、犠打、犠飛など）から算出します
        // ここでは便宜上、打席あたりの結果確率を直接定義しています。
        // （これらの数値は、ツールの作成時点での一般的な認識に基づいた仮想のものです。
        //   正確なデータを反映させる場合は、最新の公式記録から算出してください。）

        const probabilities = {
            'single':    0.180, // 単打
            'double':    0.050, // 二塁打
            'triple':    0.005, // 三塁打
            'homerun':   0.065, // 本塁打
            'walk':      0.120, // 四球
            'strikeout': 0.250  // 三振
            // 'out' は残りの確率で計算
        };

        // 凡打の種類とそれぞれの確率（凡打の合計確率を等分する）
        const outTypes = [
            'ゴロ (一塁)', 'ゴロ (二塁)', 'ゴロ (三塁)', 'ゴロ (遊撃)',
            'ライナー (一塁)', 'ライナー (二塁)', 'ライナー (三塁)', 'ライナー (遊撃)',
            'フライ (右翼)', 'フライ (中堅)', 'フライ (左翼)', 'フライ (捕手)', 'フライ (投手)',
            '犠打', '犠飛' // 犠打と犠飛も凡打に含めるが、打数計算時には区別
        ];

        // 凡打の合計確率を計算し、残りを設定
        const sumKnownProb = Object.values(probabilities).reduce((a, b) => a + b, 0);
        const outProb = parseFloat((1.000 - sumKnownProb).toFixed(3)); // 凡打の合計確率（小数点3桁まで）

        // 各凡打の確率（小数点3桁まで）
        const probPerOutType = parseFloat((outProb / outTypes.length).toFixed(3));

        // 凡打の種類をprobabilitiesに追加
        outTypes.forEach(type => {
            probabilities[type] = probPerOutType;
        });

        // 最終的な確率合計を確認 (浮動小数点誤差により1.000にならない場合があるが許容範囲内とする)
        const finalSumProb = Object.values(probabilities).reduce((a, b) => a + b, 0);
        console.log("最終的な確率合計:", finalSumProb.toFixed(3)); // デバッグ用

        function getAtBatResult() {
            const rand = Math.random();
            let cumulativeProb = 0;

            for (const result in probabilities) {
                cumulativeProb += probabilities[result];
                if (rand < cumulativeProb) {
                    return result;
                }
            }
            // 万が一のフォールバック (通常はここには来ないはず)
            return '凡打';
        }

        function getResultText(result) {
            switch (result) {
                case 'single': return '単打';
                case 'double': return '二塁打';
                case 'triple': return '三塁打';
                case 'homerun': return '本塁打';
                case 'walk': return '四球';
                case 'strikeout': return '三振';
                case '犠打': return '犠打';
                case '犠飛': return '犠飛';
                default:
                    // その他の凡打の場合
                    if (outTypes.includes(result)) {
                        return result;
                    }
                    return '不明';
            }
        }

        function simulateAtBat() {
            const result = getAtBatResult();
            return {
                resultType: result,
                text: getResultText(result)
            };
        }

        function predictGame() {
            const resultSection = document.getElementById('resultSection');
            resultSection.innerHTML = ''; // 前回の結果をクリア

            let hits = 0;
            let doubles = 0;
            let triples = 0;
            let homers = 0;
            let walks = 0;
            let strikeouts = 0;
            let outs = 0; // 四球、犠打、犠飛、三振以外の凡打
            let sacrifices = 0; // 犠打+犠飛
            let sacBunts = 0; // 犠打
            let sacFlies = 0; // 犠飛

            let plateAppearances = 4; // 打席数
            let atBatsCount = 0; // 打数

            for (let i = 1; i <= plateAppearances; i++) {
                const { resultType, text } = simulateAtBat();

                const atBatDiv = document.createElement('div');
                atBatDiv.classList.add('at-bat');

                if (resultType === 'single' || resultType === 'double' || resultType === 'triple' || resultType === 'homerun') {
                    hits++;
                    atBatsCount++; // 安打は打数にカウント
                    if (resultType === 'double') {
                        doubles++;
                    } else if (resultType === 'triple') {
                        triples++;
                    } else if (resultType === 'homerun') {
                        homers++;
                    }
                } else if (resultType === 'walk') {
                    walks++;
                    // 四球は打数にカウントしない
                } else if (resultType === 'strikeout') {
                    strikeouts++;
                    atBatsCount++; // 三振は打数にカウント
                } else if (resultType === '犠打') {
                    sacrifices++;
                    sacBunts++;
                    // 犠打は打数にカウントしない
                } else if (resultType === '犠飛') {
                    sacrifices++;
                    sacFlies++;
                    // 犠飛は打数にカウントしない
                }
                else if (outTypes.includes(resultType)) { // その他の凡打
                    outs++;
                    atBatsCount++; // 凡打は打数にカウント
                }

                let display_text = text;
                if (resultType === 'homerun') {
                    display_text += ' 🎉';
                }
                atBatDiv.innerHTML = `<strong>第${i}打席:</strong> ${display_text}`;
                resultSection.appendChild(atBatDiv);
            }

            const summaryDiv = document.createElement('div');
            summaryDiv.classList.add('summary');

            // 打率などの計算
            const battingAvg = atBatsCount > 0 ? (hits / atBatsCount).toFixed(3) : '---';
            const onBasePct = (atBatsCount + walks + sacrifices) > 0 ? ((hits + walks) / (atBatsCount + walks + sacrifices)).toFixed(3) : '---'; // AB + BB + SF
            const sluggingPct = atBatsCount > 0 ? ((hits - doubles - triples - homers) + (doubles * 2) + (triples * 3) + (homers * 4)) / atBatsCount : '---';
            const ops = (onBasePct !== '---' && sluggingPct !== '---') ? (parseFloat(onBasePct) + sluggingPct).toFixed(3) : '---';
            const sluggingPctDisplay = sluggingPct !== '---' ? sluggingPct.toFixed(3) : '---';


            summaryDiv.innerHTML = `
                <h3>試合結果サマリー (4打席)</h3>
                <p>打席: ${plateAppearances}</p>
                <p>打数: ${atBatsCount}</p>
                <p>安打: ${hits}</p>
                <p>二塁打: ${doubles}</p>
                <p>三塁打: ${triples}</p>
                <p>本塁打: ${homers}</p>
                <p>四球: ${walks}</p>
                <p>三振: ${strikeouts}</p>
                <p>凡打（その他）: ${outs}</p>
                <p>犠打: ${sacBunts}</p>
                <p>犠飛: ${sacFlies}</p>
                <p>打率: ${battingAvg}</p>
                <p>出塁率: ${onBasePct}</p>
                <p>長打率: ${sluggingPctDisplay}</p>
                <p>OPS: ${ops}</p>
            `;
            resultSection.appendChild(summaryDiv);
        }

        function predictSeason() {
            const resultSection = document.getElementById('resultSection');
            resultSection.innerHTML = ''; // 前回の結果をクリア

            let totalHits = 0;
            let totalDoubles = 0;
            let totalTriples = 0;
            let totalHomers = 0;
            let totalWalks = 0;
            let totalStrikeouts = 0;
            let totalOuts = 0; // 四球、犠打、犠飛、三振以外の凡打
            let totalSacBunts = 0; // 犠打
            let totalSacFlies = 0; // 犠飛

            const gamesInSeason = 162;
            const atBatsPerGame = 4; // 1試合あたりの平均打席数として仮定

            let totalPlateAppearances = 0; // 合計打席数
            let totalAtBats = 0; // 合計打数

            for (let g = 0; g < gamesInSeason; g++) {
                for (let i = 0; i < atBatsPerGame; i++) {
                    totalPlateAppearances++; // 打席数をカウント
                    const { resultType } = simulateAtBat();

                    if (resultType === 'single' || resultType === 'double' || resultType === 'triple' || resultType === 'homerun') {
                        totalHits++;
                        totalAtBats++; // 安打は打数にカウント
                        if (resultType === 'double') {
                            totalDoubles++;
                        } else if (resultType === 'triple') {
                            totalTriples++;
                        } else if (resultType === 'homerun') {
                            totalHomers++;
                        }
                    } else if (resultType === 'walk') {
                        totalWalks++;
                        // 四球は打数にカウントしない
                    } else if (resultType === 'strikeout') {
                        totalStrikeouts++;
                        totalAtBats++; // 三振は打数にカウント
                    } else if (resultType === '犠打') {
                        totalSacBunts++;
                        // 犠打は打数にカウントしない
                    } else if (resultType === '犠飛') {
                        totalSacFlies++;
                        // 犠飛は打数にカウントしない
                    } else if (outTypes.includes(resultType)) { // その他の凡打
                        totalOuts++;
                        totalAtBats++; // 凡打は打数にカウント
                    }
                }
            }

            // 主要打者指標の計算
            const totalSingles = totalHits - totalDoubles - totalTriples - totalHomers;
            const totalBases = totalSingles + (totalDoubles * 2) + (totalTriples * 3) + (totalHomers * 4);

            const battingAvg = totalAtBats > 0 ? (totalHits / totalAtBats).toFixed(3) : '---';
            const onBasePctDenominator = totalAtBats + totalWalks + totalSacFlies; // AB + BB + SF
            const onBasePct = onBasePctDenominator > 0 ? ((totalHits + totalWalks) / onBasePctDenominator).toFixed(3) : '---';
            const sluggingPct = totalAtBats > 0 ? (totalBases / totalAtBats).toFixed(3) : '---';
            const ops = (onBasePct !== '---' && sluggingPct !== '---') ? (parseFloat(onBasePct) + parseFloat(sluggingPct)).toFixed(3) : '---';

            const singlesPerHit = totalHits > 0 ? (totalSingles / totalHits * 100).toFixed(1) : '0.0';
            const doublesPerHit = totalHits > 0 ? (totalDoubles / totalHits * 100).toFixed(1) : '0.0';
            const triplesPerHit = totalHits > 0 ? (totalTriples / totalHits * 100).toFixed(1) : '0.0';
            const homersPerHit = totalHits > 0 ? (totalHomers / totalHits * 100).toFixed(1) : '0.0';

            const strikeoutRate = totalPlateAppearances > 0 ? (totalStrikeouts / totalPlateAppearances * 100).toFixed(1) : '0.0';
            const walkRate = totalPlateAppearances > 0 ? (totalWalks / totalPlateAppearances * 100).toFixed(1) : '0.0';

            const summaryDiv = document.createElement('div');
            summaryDiv.classList.add('summary');
            summaryDiv.innerHTML = `
                <h3>1シーズン (162試合) の結果サマリー</h3>
                <table class="season-summary-table">
                    <thead>
                        <tr>
                            <th>項目</th>
                            <th>合計</th>
                            <th>率 (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>試合</td><td colspan="2">${gamesInSeason}</td></tr>
                        <tr><td>打席</td><td colspan="2">${totalPlateAppearances}</td></tr>
                        <tr><td>打数</td><td colspan="2">${totalAtBats}</td></tr>
                        <tr><td>安打</td><td colspan="2">${totalHits}</td></tr>
                        <tr><td>単打</td><td>${totalSingles}</td><td>${singlesPerHit}</td></tr>
                        <tr><td>二塁打</td><td>${totalDoubles}</td><td>${doublesPerHit}</td></tr>
                        <tr><td>三塁打</td><td>${totalTriples}</td><td>${triplesPerHit}</td></tr>
                        <tr><td>本塁打</td><td>${totalHomers}</td><td>${homersPerHit}</td></tr>
                        <tr><td>四球</td><td>${totalWalks}</td><td>${walkRate}</td></tr>
                        <tr><td>三振</td><td>${totalStrikeouts}</td><td>${strikeoutRate}</td></tr>
                        <tr><td>犠打</td><td colspan="2">${totalSacBunts}</td></tr>
                        <tr><td>犠飛</td><td colspan="2">${totalSacFlies}</td></tr>
                        <tr><td>凡打（その他）</td><td colspan="2">${totalOuts}</td></tr>
                        <tr><td>塁打</td><td colspan="2">${totalBases}</td></tr>
                    </tbody>
                </table>
                <p><strong>打率 (AVG):</strong> ${battingAvg}</p>
                <p><strong>出塁率 (OBP):</strong> ${onBasePct}</p>
                <p><strong>長打率 (SLG):</strong> ${sluggingPct}</p>
                <p><strong>OPS:</strong> ${ops}</p>
                <p class="note">※1試合あたり4打席として計算しています。実際の打席数は変動します。</p>
            `;
            resultSection.appendChild(summaryDiv);
        }
    </script>
</body>
</html>
